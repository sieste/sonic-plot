<html>

<head>
  <script src="plot.ly/plotly-latest.min.js"></script>
  <script src="audiosynth/audiosynth.js"></script>
  <script src="speak.js/speakClient.js"></script>
</head>

<body>

<p>
<ul>
<li>Hovering the map plays a sound with frequency modulated by data</li>
<li>Click on a point to read out coordinates and value</li>
</ul>
</p>
<br>
<div id='plotdiv' style='width:100%; height:100%'></div>
<div id="audio"></div>


<script>

  // function to play a sound, expected argument is an integer between 0 and 6 
  var sound = Synth.createInstrument('pling');
  play = function(value) {
    value = Math.round(Math.max(Math.min(value, 6), 0))
    notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B']
    sound.play(notes[value], 4, .1); // play note in 4th octave for .1sec using the custom 'pling' sound 
  }
  
  // data is a north-south gradient on lat-lon grid over UK
  data = []
  lat_seq = [49, 60, .5]
  lon_seq = [-8, 3, .5]
  for (lat = lat_seq[0]; lat <= lat_seq[1]; lat+=lat_seq[2]) {
    for (lon = lon_seq[0]; lon <= lon_seq[1]; lon+=lon_seq[2]) {
      val = Math.round((lat - lat_seq[0]) / (lat_seq[1] - lat_seq[0]) * 6)
      data.push({
        lat: [lat],
        lon: [lon],
        value: val,
        text: 'lat: '+lat.toFixed(1)+', lon: '+lon.toFixed(1)+', value: '+val,
        type: 'scattergeo',
        mode: 'markers',
        marker: {size: 32, color: 'rgba('+(val/6*255)+',0,0,.3)', symbol: 'square'},
        showlegend: false
      })
    }
  }
  
  // map plot with plotly
  var layout = {
    geo: {
      resolution: 50,
      lonaxis: {
        'range': [-8, 3]
      },
      lataxis: {
        'range': [49, 60]
      }
    }
  }
  Plotly.newPlot('plotdiv', data, layout)
  
  // hover interaction: play sound with frequency modulated by value 
  document.getElementById('plotdiv').on('plotly_hover', function(d) {
    play(d.points[0].data.value)
  })
  // click interaction: play sound and read data 
  document.getElementById('plotdiv').on('plotly_click', function(d) {
    lat = d.points[0].data.lat[0].toFixed(1)
    lon = d.points[0].data.lon[0].toFixed(1)
    val = d.points[0].data.value
    text = 'lat: '+ lat + ', lon: ' + lon +', value: ' + val,
    speak(text)
  })

</script>

</body>
</html>

